# Generated by Chef for <%= node["fqdn"] %>.
# Local modifications will be overwritten.

<% if node["platform_family"] == "debian" -%>
# debian-sys-maint user for administration
  <% [['SELECT', 'mysql.user'], ['SHUTDOWN', '*.*']].each do |priv, loc| %>
<%= "GRANT #{priv} ON #{loc} TO '#{@debian_user}'@'localhost' IDENTIFIED BY '#{@debian_password}';" %>
  <% end -%>
<% end -%>


<% if node["percona"]["backup"]["configure"] %>
# Grant permissions for the XtraBackup user
# Ensure the user exists, then revoke all grants, then re-grant specific permissions
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO '<%= node["percona"]["backup"]["username"] %>'@'localhost' IDENTIFIED BY '<%= @backup_password %>';
REVOKE ALL PRIVILEGES, GRANT OPTION FROM '<%= node["percona"]["backup"]["username"] %>'@'*';
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO '<%= node["percona"]["backup"]["username"] %>'@'localhost' IDENTIFIED BY '<%= @backup_password %>';
<% end -%>

# Set the server root password. This should be preseeded by the package installation.
# Add ALL root accounts - JPA
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('<%= @root_password %>');
SET PASSWORD FOR 'root'@'127.0.0.1' = PASSWORD('<%= @root_password %>');
SET PASSWORD FOR 'root'@'::1' = PASSWORD('<%= @root_password %>');
SET PASSWORD FOR 'root'@'<%= node.hostname %>' = PASSWORD('<%= @root_password %>');

FLUSH PRIVILEGES;
